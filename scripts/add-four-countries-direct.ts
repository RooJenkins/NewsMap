import 'dotenv/config'
import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()

// Manual summaries crafted based on November 2025 research
const SUMMARIES = {
  'Democratic Republic of Congo': {
    summary: `# Democratic Republic of Congo

The Democratic Republic of Congo enters November 2025 navigating fragile peace mechanisms with Rwanda-backed M23 rebels while facing continued political repression under President Felix Tshisekedi's government. Eastern provinces remain under de facto M23 control despite US-brokered frameworks aimed at regional stability.

## Major Issues

### 1. M23 Rebel Entrenchment and Regional Peace Process
**What's happening:**
- DRC and Rwanda signed US-backed Regional Economic Integration Framework (REIF) in early November 2025
- First monitoring meeting held for ceasefire verification mechanism between Congolese government and M23
- M23 established inspector general office, recruited 370+ officials for parallel judicial system, and formally created arbitration center
- Military clashes continued: M23-aligned militia fighters captured villages in Fizi and Mwenga highlands (South Kivu) while Wazalendo fighters repelled M23 attacks along RP503

**Why it matters:**
- M23's administrative consolidation signals long-term territorial ambitions beyond tactical military gains
- Parallel governance structures undermine DRC state sovereignty and complicate eventual peace settlement
- Continued violence threatens humanitarian access to millions in eastern provinces
- Regional economic integration framework may be undermined if territorial disputes persist

**Prospects:**
- Short-term: Ceasefire verification mechanism faces immediate test as clashes continue
- Medium-term: US diplomatic engagement suggests sustained international attention, but enforcement mechanisms remain weak
- Risk: M23 may use peace process as cover to consolidate territorial gains; Rwanda's strategic interests in eastern DRC minerals (coltan, cobalt) incentivize continued proxy support

### 2. Political Repression and Democratic Backsliding
**What's happening:**
- Former presidential candidate Seth Kikuni sentenced to one year in prison for "propagating rumors" and "incentivizing civil disobedience" in November 2025
- Human rights defenders Jack Sinzahera and Gloire Saasita released November 8 after being held without charge for weeks
- Meaningful political opposition virtually nonexistent under Tshisekedi government
- Expressions of dissent draw criminal prosecution and imprisonment

**Why it matters:**
- Shrinking civic space threatens democratic accountability and reform prospects
- International donors and investors increasingly factor governance quality into engagement decisions
- Opposition suppression may fuel underground resistance movements
- Human rights record affects DRC's ability to secure Western diplomatic and military support against M23

**Prospects:**
- Short-term: Authoritarian governance likely to continue given weak institutional checks
- Medium-term: 2028 presidential election cycle may see renewed restrictions on opposition activity
- Opportunity: International pressure tied to peace process could create leverage for human rights conditionality

### 3. Humanitarian Crisis in Eastern Provinces
**What's happening:**
- Ongoing conflict in North Kivu and South Kivu displaces millions of civilians
- M23 control over territory disrupts humanitarian access and aid delivery
- Return of state authority identified as major obstacle to DRC-M23 peace talks
- Civilians caught between M23, Congolese forces, and pro-government Wazalendo militias

**Why it matters:**
- Eastern DRC hosts one of the world's largest displacement crises
- Disruption of agricultural production threatens food security for wider region
- Humanitarian crisis fuels regional instability and migration pressures
- International aid budgets face competing global crises

**Prospects:**
- Short-term: Humanitarian situation likely to deteriorate further if fighting continues through harvest season
- Medium-term: Any durable peace settlement must address displaced population returns and land rights
- Risk: Protracted conflict creates conditions for extremist recruitment and cross-border spillover into Uganda, Burundi, Rwanda

## Summary

The DRC remains trapped between fragile peace frameworks and persistent conflict dynamics. M23's administrative entrenchment in eastern provinces, coupled with political repression in Kinshasa, creates a dangerous trajectory where neither genuine peace nor democratic reform appears imminent. Watch for: ceasefire verification mechanism outcomes, next round of US/regional diplomatic engagement, humanitarian access trends in North and South Kivu, and any shifts in Rwanda's strategic calculus regarding M23 support.`,
    issues: ['M23 Rebel Entrenchment and Regional Peace Process', 'Political Repression and Democratic Backsliding', 'Humanitarian Crisis in Eastern Provinces'],
    shortSummary: 'M23 entrenchment, peace talks, political repression',
    location: { lat: -4.0383, lng: 21.7587 }
  },
  'Dominican Republic': {
    summary: `# Dominican Republic

The Dominican Republic closes 2025 navigating economic headwinds and fiscal policy tensions under President Luis Abinader's second term. Growth projections have been revised downward while the administration grapples with IMF pressure for structural reforms and domestic resistance to austerity measures.

## Major Issues

### 1. Economic Growth Slowdown and Monetary Policy Adjustment
**What's happening:**
- Central Bank lowered monetary policy rate from 5.50% to 5.25% in October 2025 meeting
- Economy now anticipated to close 2025 with growth of approximately 2.5%, down from earlier 5% forecast
- Growth projected to return to potential pace of 4.0%-5.0% in 2026
- Inflation pressures easing but cost-of-living concerns persist among population

**Why it matters:**
- Dominican Republic has been one of Latin America's fastest-growing economies; slowdown signals structural headwinds
- Lower growth constrains fiscal revenue for social programs and infrastructure investment
- Monetary easing reflects Central Bank confidence in inflation trajectory but also acknowledgment of growth risks
- Tourism sector (major growth driver) faces global travel demand uncertainty

**Prospects:**
- Short-term: Subdued growth through Q4 2025 and early 2026 likely
- Medium-term: Return to 4-5% growth depends on global tourism recovery, US economic health (remittance flows), and domestic investment climate
- Opportunity: Lower rates may stimulate construction and consumption sectors if credit channels function effectively

### 2. Fiscal Reform Deadlock and IMF Pressure
**What's happening:**
- IMF called for comprehensive fiscal reform to attract investment, boost revenues, and achieve investment-grade credit rating
- President Abinader introduced fiscal reform bill in October 2025 but withdrew it later that month citing lack of consensus
- Senate president Ricardo de los Santos stated country lacks economic conditions for salary indexing
- Government prioritizing selective infrastructure investments (Vallejuelo road network opened November 1) over broad reforms

**Why it matters:**
- Investment-grade rating would lower borrowing costs and attract pension fund/institutional capital
- Fiscal reform resistance reflects political constraints on Abinader despite legislative majority
- Without revenue-side reforms, social spending and infrastructure ambitions face hard budget constraints
- Regional investors and multilaterals watching fiscal trajectory as indicator of policy credibility

**Prospects:**
- Short-term: Fiscal reform unlikely before 2026; Abinader will avoid politically costly measures ahead of 2028 election cycle
- Medium-term: IMF conditionality may force gradual subsidy reduction and tax base expansion
- Risk: Continued postponement of reforms could trigger credit rating downgrade or loss of concessional financing access

### 3. Sustainable Tourism Development and Economic Diversification
**What's happening:**
- Zemi Miches All-Inclusive Resort opened October 29, 2025, marking push for sustainable, differentiated tourism in Miches region
- Government positioning new tourism zones as premium, eco-conscious alternatives to Punta Cana mass-market model
- President Abinader skipped Brazil Climate Summit (November 2025) to focus on domestic priorities, signaling limited bandwidth for international climate diplomacy

**Why it matters:**
- Tourism represents over 17% of GDP and major employment source
- Overdependence on single sector creates vulnerability to external shocks (pandemics, US recessions)
- Sustainable tourism branding essential for attracting high-spending visitors amid Caribbean competition
- Climate resilience critical for long-term sector viability (hurricanes, sea-level rise)

**Prospects:**
- Short-term: Miches development serves as test case for premium tourism model; early success could attract further investment
- Medium-term: Economic diversification requires moving beyond tourism into logistics, nearshoring manufacturing, financial services
- Opportunity: US-China tensions create nearshoring opportunities for Dominican manufacturers targeting US market

## Summary

The Dominican Republic faces a classic middle-income trap scenario: strong recent growth creating expectations for continued prosperity, but structural reforms necessary for next development phase remain politically difficult. Abinader's withdrawal of fiscal reform despite IMF pressure highlights the tension between technocratic advice and electoral politics. Watch for: 2026 growth trajectory, any renewed fiscal reform attempts post-2026, tourism sector performance metrics from Miches and other new zones, and government response to next IMF review.`,
    issues: ['Economic Growth Slowdown and Monetary Policy Adjustment', 'Fiscal Reform Deadlock and IMF Pressure', 'Sustainable Tourism Development and Economic Diversification'],
    shortSummary: 'Growth slowdown, fiscal reform deadlock, tourism push',
    location: { lat: 18.7357, lng: -70.1627 }
  },
  'Ecuador': {
    summary: `# Ecuador

Ecuador confronts a multifaceted crisis in November 2025 as President Daniel Noboa attempts to consolidate power through a constitutional referendum while facing escalating organized crime violence, institutional erosion, and democratic backsliding. The November 16 referendum represents a critical juncture for Ecuador's political trajectory.

## Major Issues

### 1. Constitutional Referendum and Democratic Legitimacy
**What's happening:**
- November 16, 2025: National referendum with 4 questions including proposal to convene constituent assembly to draft new constitution
- 13.9 million registered voters participating; nearly 119,000 troops and police deployed for security
- National Electoral Council (CNE) established joint security table with 20+ institutions; explosive-ordnance teams positioned nationwide
- Vice President VerÃ³nica Abad suspended by Ministry of Labor for "unjustified abandonment" just weeks before she was to replace President Noboa during electoral campaign

**Why it matters:**
- Constitutional referendum serves as de facto confidence vote on Noboa's authoritarian approach to security crisis
- Suspension of VP Abad on dubious legal grounds signals willingness to bend institutions for political advantage
- New constitution could entrench executive power and weaken checks and balances
- Massive security deployment for voting reflects state's acknowledgment that it doesn't control significant territory

**Prospects:**
- Short-term: Referendum results will determine whether Noboa can proceed with constituent assembly and constitutional rewrite
- Medium-term: If approved, constituent assembly process could dominate 2026 politics and distract from security/economic crises
- Risk: Rejection of referendum would leave Noboa politically weakened and unable to implement his governance vision; approval could accelerate democratic erosion

### 2. Organized Crime Violence and State Capacity Collapse
**What's happening:**
- Violence surge attributed to organized criminal networks controlling drug trafficking routes
- Government ordered investigations into whether previous administrations underreported homicide and organized crime figures
- Supreme Electoral Tribunal barred presidential candidate Jan Topic from 2025 election based on "confidential evidence" raising due process concerns
- Fundamedios reported 160+ attacks on press freedom in November, mostly by state actors and organized crime

**Why it matters:**
- Ecuador transformed from relative regional safe haven to one of Latin America's most violent countries in just 3 years
- Organized crime penetration of state institutions undermines policy effectiveness
- Press freedom restrictions prevent accurate public information about security situation
- Criminal groups' territorial control challenges basic state sovereignty

**Prospects:**
- Short-term: Violence likely to continue regardless of referendum outcome; security forces overstretched
- Medium-term: Noboa's militarized approach may suppress some violence but won't address root causes (prison gang power, corruption, drug trafficking economics)
- Risk: State-crime collusion patterns emerging; if institutionalized, could create "narco-state" trajectory similar to Mexico or Colombia in earlier decades

### 3. Institutional Erosion and Rule of Law Crisis
**What's happening:**
- Ministry of Labor suspended VP without clear legal basis
- Supreme Electoral Tribunal barred candidate using "confidential evidence" without transparency
- Fundamedios documented 160+ attacks on expression/press freedom, mostly by state actors
- Government revision of previous administrations' crime statistics suggests data manipulation for political purposes

**Why it matters:**
- Rule of law deterioration affects investor confidence and economic prospects
- Arbitrary institutional actions create unpredictability for businesses and citizens
- International partners (US, EU) condition aid and trade on democratic governance standards
- Institutional weakness makes Ecuador vulnerable to further crime infiltration

**Prospects:**
- Short-term: Noboa administration likely to continue prioritizing security results over procedural norms
- Medium-term: If constitutional reforms pass, institutional constraints on executive power could weaken further
- Opportunity: International pressure and conditionality could create leverage for civil society groups advocating institutional strengthening

## Summary

Ecuador stands at a crossroads between two dangerous paths: continued democratic erosion under Noboa's authoritarian security approach, or state collapse in the face of organized crime penetration. The November 16 referendum will reveal whether Ecuadorian voters are willing to trade democratic norms for promised security gains. Watch for: referendum results and post-vote political dynamics, homicide and extortion trends in Guayaquil and Quito, any purges or institutional reforms following electoral tribunal decisions, and regional responses (Colombia, Peru) to Ecuador's instability.`,
    issues: ['Constitutional Referendum and Democratic Legitimacy', 'Organized Crime Violence and State Capacity Collapse', 'Institutional Erosion and Rule of Law Crisis'],
    shortSummary: 'Nov 16 referendum, crime surge, democratic backsliding',
    location: { lat: -1.8312, lng: -78.1834 }
  },
  'Egypt': {
    summary: `# Egypt

Egypt navigates a severe economic crisis and hollow democratic rituals in November 2025 as President Abdel Fattah al-Sisi consolidates authoritarian control while managing massive external debt through international bailouts. Parliamentary elections signal continuity of repressive governance amid mounting economic pressures on ordinary Egyptians.

## Major Issues

### 1. Parliamentary Elections and Authoritarian Consolidation
**What's happening:**
- Parliamentary elections began November 10 for 596-seat House of Representatives
- Phase 1 covered 14 governorates with results announced November 18; second phase to follow
- Expected low turnout due to dominance of pro-government candidates and voter apathy
- Meaningful political opposition virtually nonexistent; expressions of dissent can draw criminal prosecution and imprisonment

**Why it matters:**
- Elections serve as ritualized legitimation exercise for Sisi regime rather than genuine democratic competition
- Parliament functions as rubber-stamp institution with no real legislative independence
- Absence of opposition prevents policy debate on economic crisis management
- International partners (particularly EU) face tension between criticizing authoritarianism and maintaining migration/security cooperation

**Prospects:**
- Short-term: Pro-government supermajority guaranteed; low turnout will be spun as stability indicator
- Medium-term: Sisi likely to seek constitutional amendments for further term extensions beyond current mandate
- Risk: Complete closure of political space increases pressure for underground opposition and potential instability

### 2. Economic Crisis and External Dependence
**What's happening:**
- Inflation at 12% making daily life difficult; food and fuel costs rising sharply
- Egyptian pound lost value multiple times since 2022; ongoing currency instability
- Egypt secured $57 billion in bailout deals since January 2025
- Total external assistance exceeds $60 billion (since 2024) against $152 billion external debt as of June 2025
- Houthi Red Sea attacks reduced Suez Canal traffic 60% since 2023, depriving Egypt of critical hard currency revenues

**Why it matters:**
- External debt servicing consumes enormous portion of government budget, crowding out social spending
- Currency instability and inflation devastate household purchasing power and living standards
- Loss of Suez Canal revenues (historically 5-6% of GDP) creates structural fiscal gap
- Dependence on Gulf bailouts (UAE, Saudi Arabia) and IMF gives external actors leverage over Egyptian policy
- Economic distress creates potential for social unrest despite repressive security apparatus

**Prospects:**
- Short-term: Further subsidy cuts and austerity measures likely to meet IMF conditions; inflation to remain elevated
- Medium-term: Economic stabilization requires addressing structural issues (state dominance of economy, inefficient public sector, business environment barriers) but Sisi regime relies on military-controlled economic empire
- Risk: Economic desperation could spark renewed protests; Sisi's reliance on security services to maintain control creates vicious cycle

### 3. Regional Diplomacy and Gaza Ceasefire Mediation
**What's happening:**
- Egypt took increasingly proactive regional role as key Gaza ceasefire negotiator alongside Qatar
- Deployed Foreign Ministry representatives to Lebanon in recent weeks
- Balancing act between maintaining Camp David peace treaty with Israel and positioning as Arab world leader
- Regional diplomacy helps Egypt maintain Western support and Gulf financial flows

**Why it matters:**
- Gaza mediation role gives Egypt diplomatic relevance beyond its economic weight
- Regional instability (Gaza war, Lebanon crisis, Red Sea shipping disruptions) directly affects Egyptian security and economy
- Successful mediation enhances international standing and potentially unlocks additional financial support
- Egypt's ability to manage Sinai security and Rafah crossing gives it unique leverage with Israel

**Prospects:**
- Short-term: Egypt will continue mediation role as long as Gaza conflict continues; domestic economic benefits from maintaining diplomatic centrality
- Medium-term: Regional stability serves Egyptian economic interests (Red Sea shipping, tourism, Suez Canal revenues)
- Opportunity: Could leverage regional role to secure additional Western aid tied to migration control and counterterrorism cooperation

## Summary

Egypt exemplifies authoritarian stability built on external financial life-support and repression of dissent. The November parliamentary elections serve as window-dressing for a regime facing existential economic pressures that no amount of IMF/Gulf bailouts can solve without fundamental governance reforms Sisi is unwilling to implement. The gap between Egypt's regional diplomatic profile and its economic fragility creates a brittle status quo vulnerable to external shocks. Watch for: Phase 2 election results and turnout figures, next IMF review conditions, currency stability trends, bread/fuel subsidy policy, Suez Canal revenue recovery trajectory, and any signals of Gulf patience with continued bailouts.`,
    issues: ['Parliamentary Elections and Authoritarian Consolidation', 'Economic Crisis and External Dependence', 'Regional Diplomacy and Gaza Ceasefire Mediation'],
    shortSummary: 'Parliamentary elections, economic crisis, Gaza mediation',
    location: { lat: 26.8206, lng: 30.8025 }
  }
}

async function addFourCountries() {
  console.log('Adding four countries with comprehensive summaries...\n')

  const countries = [
    {
      name: 'Democratic Republic of Congo',
      type: 'country',
      country: 'Democratic Republic of Congo',
      ...SUMMARIES['Democratic Republic of Congo'].location
    },
    {
      name: 'Dominican Republic',
      type: 'country',
      country: 'Dominican Republic',
      ...SUMMARIES['Dominican Republic'].location
    },
    {
      name: 'Ecuador',
      type: 'country',
      country: 'Ecuador',
      ...SUMMARIES['Ecuador'].location
    },
    {
      name: 'Egypt',
      type: 'country',
      country: 'Egypt',
      ...SUMMARIES['Egypt'].location
    }
  ]

  let added = 0

  for (const location of countries) {
    console.log(`\nProcessing: ${location.name}`)

    const summaryData = SUMMARIES[location.name as keyof typeof SUMMARIES]

    try {
      await prisma.locationSummary.upsert({
        where: {
          name_type: {
            name: location.name,
            type: location.type
          }
        },
        create: {
          name: location.name,
          type: location.type,
          country: location.country,
          lat: location.lat,
          lng: location.lng,
          summary: summaryData.summary,
          issues: JSON.stringify(summaryData.issues),
          topStories: JSON.stringify([]), // No specific stories for these
          storyCount: 0,
          updatedAt: new Date()
        },
        update: {
          summary: summaryData.summary,
          issues: JSON.stringify(summaryData.issues),
          topStories: JSON.stringify([]),
          storyCount: 0,
          updatedAt: new Date()
        }
      })

      added++
      console.log(`  âœ“ Added to database`)
      console.log(`  Short summary: ${summaryData.shortSummary}`)

    } catch (error) {
      console.error(`  âœ— Failed:`, error)
    }
  }

  console.log(`\n\nComplete!`)
  console.log(`Added: ${added} countries`)

  // Show final database stats
  const counts = await prisma.locationSummary.groupBy({
    by: ['type'],
    _count: true
  })

  console.log(`\nðŸ“Š Location Summary Database:`)
  counts.forEach(({ type, _count }) => {
    console.log(`   ${type}: ${_count}`)
  })
}

addFourCountries()
  .catch(console.error)
  .finally(() => prisma.$disconnect())
