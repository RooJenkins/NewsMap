import 'dotenv/config'
import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()

async function addNepalSummary() {
  console.log('ðŸ‡³ðŸ‡µ Adding Nepal country summary...\n')

  const summary = `# Nepal

Picture this: September 9, 2025. Kathmandu's streets are on fireâ€”literally. Nepal's Parliament building is ablaze. Protesters are torching politicians' homes. Police are firing rubber bullets and live ammunition into crowds of twenty-somethings armed with smartphones and fury. By the time Prime Minister KP Sharma Oli resigns on Tuesday morning, 72 young people are dead and over 2,100 are injured. The trigger? A government ban on Facebook, YouTube, and WhatsApp. But the real story is about Nepal's Gen Z finally snapping after decades of watching corrupt politicians and their "nepo kids" flaunt wealth while the country stagnates. Welcome to Nepal's bloodiest political upheaval since the Maoist insurgencyâ€”and it all started with a social media ban.

**The Big Issue 1: Gen Z Toppled a Government, Now What?**

Let's be clear: this wasn't just about Instagram access. The September uprising was the culmination of years of frustration with a political class that has treated governance like a revolving door. KP Sharma Oli, the 73-year-old Communist leader, had formed yet another coalition government with the centrist Nepali Congressâ€”the eighth government in seven years. Under their power-sharing deal, Oli and NC leader Sher Bahadur Deuba were supposed to alternate as prime minister before the 2027 elections. Cozy arrangement, right?

But then came the viral "Nepo Kids" movement. Young Nepalis started posting videos of politicians' children showing off their Range Rovers, designer bags, and luxury lifestylesâ€”in a country where youth unemployment is rampant and GDP per capita sits around $1,400. When the government banned social media platforms on September 7 to "maintain social harmony," it was the match to the powder keg. Within 24 hours, tens of thousands were in the streets. Within 48 hours, at least 19 were dead. By Monday evening, Home Minister Ramesh Lekhak resigned claiming "moral responsibility." By Tuesday, Oli was gone.

Enter Sushila Karki, Nepal's first woman prime minister, sworn in September 12 to lead an interim government. By November 2025, she's trying to hold things together until the House of Representatives elections scheduled for March 5, 2026. The Election Commission reports over 60% of preparations complete. But here's the uncomfortable truth: the political establishment hasn't really changed. Four ambassadors (UK, China, Qatar, USA) resigned after the interim government issued recall ordersâ€”the Supreme Court issued an interim stay on November 2, but the damage is done. The Communist factions are already jockeying for position: former UML Vice-Chairman Bhim Rawal just joined the newly formed Nepal Communist Party led by Prachanda and Madhav Kumar Nepal. Meanwhile, there's a wild-card faction led by Durga Prasai demanding the restoration of the monarchy and abolition of the constitution.

What did Gen Z actually win? They got rid of Oli, sure. But the system that produced himâ€”and seven governments before himâ€”is still intact. The March 2026 elections will likely produce another fragile coalition that lasts 18 months before collapsing. Unless this generation can translate street power into ballot-box results, they've won a battle but not the war.

**The Big Issue 2: The India-China Squeeze Gets Tighter**

Nepal's geography is its curse. Sandwiched between Asia's two giants, Kathmandu has to perform an exhausting diplomatic tightrope walkâ€”and the September uprising threw them off balance. Here's why both Beijing and Delhi are nervous.

Start with China. In December 2024, PM Oli broke with tradition by visiting Beijing before New Delhiâ€”a calculated snub that signaled his government's China tilt. He signed the Framework for Belt and Road Cooperation, identifying ten infrastructure projects. The signature scheme? The Trans-Himalayan Railway connecting Kathmandu to Lhasa, potentially transforming Nepal's trade dependency. China has been pushing hard: as of November 2025, they're urging Nepal to select "small projects instead of big ones" and working on a five-year plan for development in border districts. But there's a catch: China's BRI implementation has created debt traps in Sri Lanka, Pakistan, and elsewhere. Nepali officials are insisting on grants instead of high-interest loans, and progress has stalled. The fear isn't abstractâ€”it's mathematical.

Now India. Delhi controls 64% of Nepal's foreign trade, worth over $8.5 billion annually. Nepal depends on Indian oil, food, and consumer goods. When the Gen Z protests erupted, India watched nervously. Political instability in Kathmandu creates openings for Chinese influence and disrupts joint hydropower projects and development schemes. India's strategic nightmare is Nepal becoming another Bhutanâ€”except instead of India's protectorate, it becomes Beijing's corridor. The Madhesh Province crisis in Novemberâ€”where UML leader Saroj Kumar Yadav was secretly sworn in as Chief Minister at 4 AM, sparking constitutional disputes and violent protestsâ€”shows how quickly provincial politics can become proxy battles. India has historically backed Madheshi parties in the plains bordering India, while China courts the Communist parties in Kathmandu.

Mirziyoyev is gambling that economic openness can coexist with political repression. Oli gambled that China's infrastructure billions could offset India's trade stranglehold. Now, Sushila Karki's interim government has to convince both giants that Nepal won't tilt too far either wayâ€”while her own Communist party members are signing deals in Beijing and her coalition partners are flying to Delhi. Good luck with that.

**The Big Issue 3: Economic Stagnation and the Brain Drain Accelerates**

Here's the number that explains everything: Nepal's stock market index (NEPSE) dropped 5.80 points to 2,560.29 on November 10, with 151 declining stocks. Not catastrophic, but symbolic of broader malaise. Since the September unrest, investor confidence has cratered. Foreign direct investment was already anemicâ€”now it's nearly flatlined.

Meanwhile, Nepal's young people are voting with their feet. Malaysian labor disputes erupted in November when Nepal rejected Malaysia's "restrictive 10-point recruiting criteria," calling it a "syndicate system" violating transparency. But here's the thing: Nepalis are desperate for those Malaysian jobs. Youth unemployment is so severe that working on palm plantations in Southeast Asia or construction sites in the Gulf looks like a dream. Remittances from overseas workers account for roughly 25% of Nepal's GDPâ€”that's how broken the domestic economy is.

The infrastructure isn't helping. The Melamchi Water Supply project to Kathmanduâ€”supposed to solve chronic water shortagesâ€”was suspended again and only resumed in November after the interim government signed an MOU with "agitating locals." The project has been delayed for decades, billions over budget, and emblematic of Nepal's development paralysis. The Trans-Afghan Railway through Uzbekistan and Afghanistan? More realistic than most of Nepal's own infrastructure plans.

The interim government is trying. They've approved amendments to National Identity Cards allowing one-time corrections of registration errorsâ€”thrilling stuff. The Public Service Commission opened 170 positions in technical and health services, with applications due December 2. But 170 government jobs for a generation of millions is a rounding error. When your most credible economic strategy is "maybe China will build some roads," you're in trouble.

Add climate vulnerability to the mix. Nepal lost over 400 people to floods and landslides in 2024's monsoon season. The safer Mount Everest route via Nuptse Peak might be operational by mid-April 2026â€”good for the handful of wealthy climbers, useless for the millions in flood-prone lowlands. Economic opportunity is concentrated in Kathmandu and a few urban centers; rural Nepal is emptying out.

**The International Angle**

Nepal's upheaval sends ripples across South Asia and beyond. For China, instability in Kathmandu threatens billions in BRI investments and the strategic vision of a Himalayan corridor to the Indian Ocean. For India, chaos in Nepal means potential refugee flows, border security challenges, and openings for Chinese influence right on their doorstep. Modi's government is quietly relieved that Oli is goneâ€”he was too friendly with Beijingâ€”but nervous about what comes next.

The United States is watching, too. Washington's Indo-Pacific strategy depends on countering Chinese influence across South Asia. Nepal's Millennium Challenge Corporation compact with the U.S. faced fierce Communist opposition and remains controversial. Four ambassadors resigning simultaneously in Novemberâ€”including the U.S. envoyâ€”signals how seriously America views the political instability.

Then there's the democracy angle. Nepal was supposed to be South Asia's success story: a Maoist insurgency that ended through negotiation, a monarchy peacefully abolished, a federal republic established. That narrative just took 72 bullets. When Gen Z protesters had to storm Parliament and force a prime minister out because peaceful democratic mechanisms had failed, it's an indictment of two decades of supposed democratic progress. Authoritarians in Beijing, Delhi's Hindu nationalists, and strongmen across the region are taking notes: look what happens when you allow too much freedom.

**The Bottom Line**

Nepal's Gen Z just learned a hard lesson: toppling a government is easier than building one. Sushila Karki's interim administration is caretaker-in-chief until March 2026 elections that will almost certainly produce another weak coalition. The political class that young protesters tried to burn down is busy rebranding and repositioningâ€”same players, new jerseys. Meanwhile, China and India are circling like loan sharks offering credit cards with different interest rates but equally predatory terms. And Nepal's young people? They're either planning the next protest or planning their escape to Kuala Lumpur. The September uprising proved that Gen Z has power. The next three months will reveal whether they have a plan. If the March elections produce yet another geriatric coalition of corrupt party bosses playing musical chairs, don't be surprised if those 72 deaths were just the opening act.`

  const issues = [
    'Gen Z uprising: 72 dead, Oli toppled, Karki interim government',
    'India-China squeeze: BRI debt trap vs 64% trade dependency',
    'Economic collapse: Brain drain, stock market decline, infrastructure paralysis',
    'March 2026 elections: Will Gen Z translate street power to ballot power?',
    'Nepo Kids scandal: Viral movement exposing politician wealth, youth unemployment'
  ]

  const topStories = [
    {
      title: 'Nepal PM KP Sharma Oli Resigns After Gen Z Anti-Corruption Protests',
      source: 'The News',
      link: 'https://www.thenews.com.pk/latest/1342344-nepal-pm-kp-sharma-oli-resign-after-gen-z-anti-corruption-protests',
      pubDate: '2025-09-10T00:00:00.000Z'
    },
    {
      title: '72 Dead as Nepal Police Fire on Gen Z Protesters',
      source: 'Al Jazeera',
      link: 'https://www.aljazeera.com/features/2025/9/9/we-want-mass-resignations-nepals-gen-z-anger-explodes-after-19-killed',
      pubDate: '2025-09-09T00:00:00.000Z'
    },
    {
      title: 'Sushila Karki Sworn In as Nepal\'s First Woman Prime Minister',
      source: 'CNN',
      link: 'https://www.cnn.com/2025/09/10/asia/nepal-protests-gen-z-outcome-intl-hnk',
      pubDate: '2025-09-12T00:00:00.000Z'
    },
    {
      title: 'Nepal Election Commission: 60% Preparation Complete for March 2026 Vote',
      source: 'Nepal News',
      link: 'https://english.nepalnews.com/s/main-left/nepal-news-evening-briefing-wednesday-november-12-2025/',
      pubDate: '2025-11-12T00:00:00.000Z'
    },
    {
      title: 'Four Ambassadors Resign After Nepal Interim Government Recall Order',
      source: 'Nepal News',
      link: 'https://english.nepalnews.com/s/main-left/nepal-news-evening-briefing-sunday-november-10-2025/',
      pubDate: '2025-11-10T00:00:00.000Z'
    },
    {
      title: 'Madhesh Province Crisis: UML Leader Sworn In at 4 AM Sparks Constitutional Dispute',
      source: 'Nepal News',
      link: 'https://english.nepalnews.com/s/main-left/nepal-news-evening-briefing-sunday-november-10-2025/',
      pubDate: '2025-11-10T00:00:00.000Z'
    },
    {
      title: 'Nepal Decodes China\'s BRI Agreement Amid Debt Trap Fears',
      source: 'Vivekananda International Foundation',
      link: 'https://www.vifindia.org/2025/january/13/Decoding-China-s-BRI-Agreement-with-Nepal',
      pubDate: '2025-01-13T00:00:00.000Z'
    },
    {
      title: 'Nepal Rejects Malaysia\'s Labor Recruitment Criteria as "Syndicate System"',
      source: 'Nepal News',
      link: 'https://english.nepalnews.com/s/main-left/nepal-news-evening-briefing-sunday-november-10-2025/',
      pubDate: '2025-11-10T00:00:00.000Z'
    },
    {
      title: 'Melamchi Water Supply Resumes After Government-Local MOU',
      source: 'Nepal News',
      link: 'https://english.nepalnews.com/s/main-left/nepal-news-evening-briefing-wednesday-november-12-2025/',
      pubDate: '2025-11-12T00:00:00.000Z'
    },
    {
      title: 'NEPSE Index Declines 5.80 Points as Political Instability Hits Investor Confidence',
      source: 'Nepal News',
      link: 'https://english.nepalnews.com/s/main-left/nepal-news-evening-briefing-sunday-november-10-2025/',
      pubDate: '2025-11-10T00:00:00.000Z'
    }
  ]

  const tooltip = 'Gen Z revolt, 72 dead, India-China squeeze'

  try {
    // First, check if Nepal already exists
    const existing = await prisma.locationSummary.findUnique({
      where: {
        name_type_category: {
          name: 'Nepal',
          type: 'country',
          category: 'all'
        }
      }
    })

    if (existing) {
      console.log('âš ï¸  Nepal summary already exists, updating...')
      await prisma.locationSummary.update({
        where: {
          name_type_category: {
            name: 'Nepal',
            type: 'country',
            category: 'all'
          }
        },
        data: {
          summary,
          issues: JSON.stringify(issues),
          topStories: JSON.stringify(topStories),
          storyCount: topStories.length,
          updatedAt: new Date()
        }
      })
      console.log('âœ… Nepal summary updated successfully!')
    } else {
      console.log('ðŸ“ Creating new Nepal summary...')
      await prisma.locationSummary.create({
        data: {
          name: 'Nepal',
          type: 'country',
          country: 'Nepal',
          lat: 28.3949,
          lng: 84.1240,
          category: 'all',
          summary,
          issues: JSON.stringify(issues),
          topStories: JSON.stringify(topStories),
          storyCount: topStories.length,
          updatedAt: new Date(),
          createdAt: new Date()
        }
      })
      console.log('âœ… Nepal summary created successfully!')
    }

    console.log('\nðŸ“Š Summary Details:')
    console.log(`   Name: Nepal`)
    console.log(`   Type: country`)
    console.log(`   Category: all`)
    console.log(`   Coordinates: 28.3949, 84.1240`)
    console.log(`   Issues: ${issues.length}`)
    console.log(`   Top Stories: ${topStories.length}`)
    console.log(`   Character Count: ${summary.length}`)
    console.log(`   Tooltip: "${tooltip}"`)
    console.log('\nðŸŽ¯ Next Step: Add tooltip to MapViewLocations.tsx')
    console.log(`   Add after Netherlands entry (line ~185):`)
    console.log(`   'Nepal': '${tooltip}'`)

  } catch (error) {
    console.error('âŒ Error adding Nepal summary:', error)
    throw error
  }
}

addNepalSummary()
  .catch(console.error)
  .finally(() => prisma.$disconnect())
