import 'dotenv/config'
import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()

const NETHERLANDS_SUMMARY = {
  name: 'Netherlands',
  type: 'country',
  lat: 52.1326,
  lng: 5.2913,
  country: 'Netherlands',
  summary: `The electoral humiliation was swift and decisive. On October 29, 2025, Geert Wilders' far-right PVV party—which had dominated Dutch politics just months earlier—lost 11 seats, plummeting from 37 to just 26 in the House of Representatives. The man who'd promised the "harshest asylum policy ever" was relegated to the opposition benches, his brief experiment in government ending in spectacular failure. In his place: Rob Jetten, the 38-year-old D66 leader who'd campaigned on climate action, housing reform, and—most importantly—political stability. It was a stunning rebuke, made all the more remarkable by how narrow the final margin was: just 29,668 votes separated D66 from the PVV, both landing on 26 seats. But in Dutch politics, that hair's breadth difference means everything. By mid-November, Jetten was deep in coalition talks, trying to assemble what he calls a "broad political center"—while Wilders watched from the sidelines, his populist wave crashing against the rocks of governing reality.

**The Big Issue 1: Wilders' Catastrophic Government Collapse**

Let's be clear: Geert Wilders didn't just lose an election. He detonated his own government. After winning 37 seats in November 2023 on a tidal wave of anti-immigration sentiment, Wilders spent 11 months trying—and failing—to implement his promised crackdown. His coalition, a motley crew including the conservative-liberal VVD, the centrist New Social Contract, and the agrarian Farmer-Citizen Movement, was always shaky. But it was immigration that killed it. In late May 2025, Wilders grew impatient with what he saw as foot-dragging on his 10-point plan: army officials at land borders, rejection of all asylum seekers, mass deportations of dual nationals convicted of crimes. His coalition partners, particularly the NSC, balked. So on June 3, Wilders pulled the plug, withdrawing the PVV from government and triggering the collapse. Prime Minister Dick Schoof, an independent technocrat who'd been appointed as a compromise figure, resigned immediately. Elections were scheduled for October 29.

Here's the thing: Wilders had campaigned on being the strongman who'd finally get tough on immigration. But governing exposed his fundamental weakness. He couldn't deliver. His party had no administrative experience, struggled to draft workable legislation, and was constantly at war with civil servants who pointed out legal and practical obstacles. By the time he torpedoed his own coalition, polls showed his support had already slipped from 23% to 20%. His campaign for the October elections was lacklustre—at one point he suspended it entirely after being named as a target of a terror cell on October 10, claiming "bad feelings." When he resumed five days later, the momentum was gone. On election night, he lost 11 seats and conceded that the PVV is unlikely to be part of the next government. The CDA, VVD, and the PvdA-GroenLinks alliance all ruled out joining any coalition he led. For a man who'd spent two decades positioning himself as the strongman outsider, being frozen out of power by the establishment must sting.

**The Big Issue 2: The Housing Crisis That Won't Go Away**

If there's one issue that transcends Dutch political divides, it's housing. And in November 2025, the crisis is worse than ever. The average home price has soared to €488,000—up 6.99% year-on-year as of September 2025. DNB, the Dutch central bank, projects prices will climb another 7.5% by year's end, then 4% in 2026. For a country with a "shortage" of 400,000 homes, particularly in the densely populated Randstad region (Amsterdam, Rotterdam, The Hague, Utrecht), it's a disaster. Young people can't afford to buy. Renters face sky-high costs, with statutory maximum rent increases linked to inflation—which has been running at 3%, well above the ECB's 2% target and eurozone averages. The combination of high inflation, rising wages, lower mortgage rates, and chronic supply shortage has created a perfect storm.

Here's where it gets political: the reason Dutch houses are so expensive is because people can borrow so much. Top earners can borrow 5.5 times their salary and up to 100% of a home's value. It's a system that drives prices relentlessly upward, enriching existing homeowners while locking out first-time buyers. Critics say Dutch policymakers have deliberately kept the system this way because homeowners vote—and they don't want their property values to crash. Rob Jetten's D66 campaigned on building more social housing and capping rent increases, but the question is whether he'll actually challenge the underlying borrowing rules. His coalition talks with the center-right CDA and VVD are focused on finding "common ground," which in Dutch politics often means compromising away the boldest reforms. Meanwhile, the housing shortage continues to fuel inequality, resentment, and political instability. It's not an exaggeration to say that whoever solves housing will dominate Dutch politics for a generation. Right now, nobody's close.

**The Big Issue 3: The Nitrogen Crisis Gets Real**

For years, the Netherlands' nitrogen crisis was a policy wonk's nightmare—a technical environmental problem that sparked farmer protests but didn't really break through. That changed in January 2025, when a Dutch court ordered the government to cut nitrogen pollution in protected nature areas after a case brought by Greenpeace Netherlands. The ruling was stark: by 2030, 50% of these protected areas must no longer suffer from nitrogen overload. Currently, only 28% meet that standard. And here's the kicker: 61% of nitrogen compounds come from agriculture, with intensive livestock farming the primary culprit. Dutch farms contain four times more animal biomass per hectare than the EU average. It's an unsustainable model, and now the courts have forced politicians to confront it.

The political fallout has been dramatic. Prime Minister Schoof's short-lived right-wing cabinet took the previous government's €24.3 billion budget to reduce nitrogen and slashed it to just €5 billion—an almost €20 billion cut. That sparked outrage from environmental groups and, ultimately, the court ruling. Now, with D66 poised to lead the next government, the pendulum is swinging hard in the other direction. Jetten's party has promised "strong steps to deal with environmental issues," including halving nitrogen loads by 2030 and curbing intensive livestock farming at the source. The Farmer-Citizen Movement, which rode farmer anger over nitrogen rules to enter the previous coalition, saw its support collapse in the October elections. The message from voters was clear: environmental protection matters, even if it means confronting powerful agricultural interests. The question now is whether Jetten can actually force through the kind of transformative policy needed—buy-outs of the most polluting farms, strict emissions caps, a fundamental restructuring of Dutch agriculture. It'll be the biggest test of his premiership.

**The International Angle**

For a small country, the Netherlands punches way above its weight internationally—and November 2025 has been no exception. On the Ukraine front, the Dutch transferred three Patriot missile launcher units to Ukraine on November 28, part of a massive €2 billion aid package for 2025 that includes €540 million specifically for Ukraine's Drone Line project. The Netherlands has pledged €10.4 billion in total military support to Ukraine, with €9.5 billion already realized or legally committed. It's made the Dutch one of Ukraine's most reliable backers, even as war fatigue grows elsewhere in Europe. This matters because the Netherlands is positioning itself as a key player in the EU's defense and security architecture post-Brexit, post-Trump.

On climate, the picture is more complicated. At COP30 in Belém, Brazil (November 10-21, 2025), the EU submitted its 2035 Nationally Determined Contribution, with Dutch negotiators pushing for bolder emissions cuts. But here's the tension: while the Netherlands rises to 5th in the 2025 Climate Change Performance Index, the new government under Schoof had actually weakened implementation efforts, making it unlikely the Dutch would hit their 2030 EU goals. With Jetten taking over, expect that to flip again—he's already promised to push for an ambitious EU 2040 target, though the center-right parties in his coalition are wary. The broader point: Dutch foreign policy is increasingly defined by being the "good European"—the country that steps up on Ukraine, on climate, on rule of law—as a way to maximize influence in Brussels. With Wilders sidelined, that strategy is back in full force.

**The Bottom Line**

The Netherlands in November 2025 is a country in flux. Wilders' populist moment has passed, undone by his inability to govern and voters' exhaustion with instability. Rob Jetten's D66 now has a shot at building a stable centrist coalition—but the challenges are immense. Housing prices are soaring, the nitrogen crisis demands radical solutions, inflation stubbornly sits at 3%, and the Dutch must navigate an increasingly unstable Europe. The coalition talks will take weeks, maybe months, with the CDA and VVD pushing D66 to moderate its most ambitious plans. Watch for compromises on housing reform and climate policy as the price of forming a government. And watch whether Jetten can hold his coalition together longer than Schoof did. If he can deliver stability and start chipping away at housing and nitrogen, he'll define Dutch politics for the next decade. If he fails, Wilders—or someone like him—will be waiting in the wings.`,
  issues: JSON.stringify([
    'Wilders\' Catastrophic Government Collapse',
    'The Housing Crisis That Won\'t Go Away',
    'The Nitrogen Crisis Gets Real'
  ]),
  topStories: JSON.stringify([
    {
      title: 'Centrist D66 party takes home win in Dutch election',
      source: 'ABC News',
      link: 'https://abcnews.go.com/International/wireStory/centrist-d66-party-takes-home-win-dutch-election-127160906',
      pubDate: new Date('2025-10-30').toISOString()
    },
    {
      title: 'Coalition negotiations to start with only D66, CDA',
      source: 'NL Times',
      link: 'https://nltimes.nl/2025/11/11/coalition-negotiations-start-d66-cda-official-report-later-today',
      pubDate: new Date('2025-11-11').toISOString()
    },
    {
      title: 'Dutch government ordered to cut nitrogen emissions by 2030',
      source: 'Euronews',
      link: 'https://www.euronews.com/green/2025/01/22/dutch-government-ordered-to-cut-nitrogen-emissions-by-2030-victory-for-greenpeace',
      pubDate: new Date('2025-01-22').toISOString()
    },
    {
      title: 'Dutch homes are unaffordable because that\'s what officials want',
      source: 'DutchNews.nl',
      link: 'https://www.dutchnews.nl/2025/07/dutch-homes-are-unaffordable-because-thats-what-officials-want/',
      pubDate: new Date('2025-07-15').toISOString()
    },
    {
      title: 'Netherlands pledges 2025 military aid to Ukraine, including air defenses',
      source: 'Euromaidan Press',
      link: 'https://euromaidanpress.com/2024/12/20/netherlands-pledges-2025-military-aid-to-ukraine-including-air-defenses-tanks-and-artillery/',
      pubDate: new Date('2024-12-20').toISOString()
    },
    {
      title: 'Dutch government collapses after far-right leader Geert Wilders quits coalition',
      source: 'France24',
      link: 'https://www.france24.com/en/europe/20250603-dutch-far-right-leader-wilders-party-quit-government-asylum-plans-netherlands-immigration',
      pubDate: new Date('2025-06-03').toISOString()
    }
  ]),
  storyCount: 15
}

async function addNetherlands() {
  console.log('Adding Netherlands to database...\n')

  try {
    const result = await prisma.locationSummary.upsert({
      where: {
        name_type_category: {
          name: NETHERLANDS_SUMMARY.name,
          type: NETHERLANDS_SUMMARY.type,
          category: 'all'
        }
      },
      create: {
        name: NETHERLANDS_SUMMARY.name,
        type: NETHERLANDS_SUMMARY.type,
        country: NETHERLANDS_SUMMARY.country,
        lat: NETHERLANDS_SUMMARY.lat,
        lng: NETHERLANDS_SUMMARY.lng,
        category: 'all',
        summary: NETHERLANDS_SUMMARY.summary,
        issues: NETHERLANDS_SUMMARY.issues,
        topStories: NETHERLANDS_SUMMARY.topStories,
        storyCount: NETHERLANDS_SUMMARY.storyCount,
        updatedAt: new Date()
      },
      update: {
        summary: NETHERLANDS_SUMMARY.summary,
        issues: NETHERLANDS_SUMMARY.issues,
        topStories: NETHERLANDS_SUMMARY.topStories,
        storyCount: NETHERLANDS_SUMMARY.storyCount,
        updatedAt: new Date()
      }
    })

    console.log('✅ Netherlands added/updated successfully')
    console.log('   ID:', result.id)
    console.log('   Name:', result.name)
    console.log('   Location:', `${result.lat}, ${result.lng}`)
    console.log('   Issues:', JSON.parse(result.issues).length)
    console.log('   Stories:', JSON.parse(result.topStories).length)
    console.log()
  } catch (error) {
    console.error('❌ Error processing Netherlands:', error)
    throw error
  }
}

addNetherlands()
  .catch(console.error)
  .finally(() => prisma.$disconnect())
