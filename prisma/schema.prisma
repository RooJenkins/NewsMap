// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Story {
  id          String   @id @default(cuid())
  title       String
  link        String   @unique
  description String?
  source      String
  pubDate     DateTime
  createdAt   DateTime @default(now())

  // Location data
  lat         Float
  lng         Float
  city        String?
  country     String?
  region      String?

  // Metadata
  importance    Float    @default(0.5)
  isBreaking    Boolean  @default(false)
  category      String?
  aiSummary     String?
  sourceQuality String   @default("medium") // major, medium, local

  @@index([lat, lng])
  @@index([pubDate])
  @@index([importance])
  @@index([sourceQuality])
}

model LocationSummary {
  id            String   @id @default(cuid())
  name          String   // e.g. "Tokyo", "Japan", "United States"
  type          String   // "country" or "city"
  country       String   // Country code or name
  lat           Float
  lng           Float
  category      String   @default("all") // "all", "politics", "technology", "climate", "economy"

  // AI-generated summary
  summary       String   // Full AI-generated summary
  issues        String   // JSON array of major issues
  topStories    String   // JSON array of top 10 news stories with links

  // Metadata
  updatedAt     DateTime @default(now())
  createdAt     DateTime @default(now())
  storyCount    Int      @default(0) // Number of stories used to generate summary

  @@unique([name, type, category])
  @@index([type])
  @@index([country])
  @@index([category])
  @@index([updatedAt])
}

model GlobalNewsStory {
  id               String   @id @default(cuid())
  rank             Int      // 1-100 ranking
  title            String
  sourceStoryId    String?  // Reference to original Story if applicable

  // Location data
  lat              Float
  lng              Float
  city             String?
  country          String
  region           String?

  // Enhanced narrative (2-6 paragraphs)
  narrative        String   // Full narrative text

  // Rest is Politics host who "wrote" this
  authorStyle      String   // "rory_stewart" | "alastair_campbell" | "anthony_scaramucci" | "katty_kay"

  // Global context
  globalSignificance String // Why this matters globally
  affectedPopulation String // Who this affects
  category           String // e.g., "politics", "conflict", "economy", "climate"

  // Metadata
  generatedAt      DateTime @default(now())
  publishDate      DateTime // Date this story batch was published (for daily 5am updates)
  isActive         Boolean  @default(true) // Current top 100 vs archived

  // Source tracking
  sources          String   // JSON array of source links/outlets

  @@index([rank])
  @@index([publishDate])
  @@index([isActive])
  @@index([lat, lng])
  @@index([category])
}
